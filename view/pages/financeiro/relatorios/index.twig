{% extends "layout/layoutMaster.twig" %}

{% block title %}{{ titulo }}{% endblock %}

{% block body %}

<div class="content-body">
    
    <div class="container-fluid">
        <div class="page-titles">
            <div class="d-flex flex-wrap align-items-center justify-content-between">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ DOMAIN }}">Home</a></li>
                    <li class="breadcrumb-item"><a href="{{ DOMAIN }}/relatorio-financeiro">Controle Financeiro</a></li>
                    <li class="breadcrumb-item active"><a href="javascript:void(0)">{{ titulo }}</a></li>
                </ol>
                {% if 'relatorio_financeiro_exportar'|verifyPermission %}
                <a href="{{ DOMAIN }}/relatorio-financeiro/exportar?data_inicio={{ data_inicio }}&data_fim={{ data_fim }}&tipo=json" class="btn btn-success text-nowrap" target="_blank">
                    <i class="fa-solid fa-download me-2"></i>Exportar Dados
                </a>
                {% endif %}
            </div>
        </div>

        <!-- Filtros de Período -->
        <div class="card">
            <div class="card-body">
                <form id="filtrosRelatorio" method="GET" class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Data Início</label>
                        <input type="date" name="data_inicio" value="{{ data_inicio }}" class="form-control">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Data Fim</label>
                        <input type="date" name="data_fim" value="{{ data_fim }}" class="form-control">
                    </div>
                    <div class="col-md-4 d-flex align-items-end gap-2">
                        <button type="submit" class="btn btn-primary flex-fill"><i class="fa fa-filter me-2"></i>Filtrar</button>
                        <button type="button" id="btnLimparFiltros" class="btn btn-secondary"><i class="fa fa-times"></i></button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Resumo Financeiro -->
        <div class="row">
            <div class="col-xl-3 col-lg-6 col-sm-6">
                <div class="widget-stat card">
                    <div class="card-body p-4">
                        <div class="media ai-icon">
                            <span class="me-3 bgl-primary text-primary">
                                <i class="fa-light fa-wallet"></i>
                            </span>
                            <div class="media-body">
                                <p class="mb-1">Total a Receber</p>
                                <h4 class="mb-0">R$ {{ totais_contas_receber.total_a_receber|default(0)|number_format(2, ',', '.') }}</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-sm-6">
                <div class="widget-stat card">
                    <div class="card-body p-4">
                        <div class="media ai-icon">
                            <span class="me-3 bgl-success text-success">
                                <i class="fa-light fa-check-circle"></i>
                            </span>
                            <div class="media-body">
                                <p class="mb-1">Total Recebido</p>
                                <h4 class="mb-0">R$ {{ totais_financeiros.total_recebimentos|default(0)|number_format(2, ',', '.') }}</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-sm-6">
                <div class="widget-stat card">
                    <div class="card-body p-4">
                        <div class="media ai-icon">
                            <span class="me-3 bgl-danger text-danger">
                                <i class="fa-light fa-minus-circle"></i>
                            </span>
                            <div class="media-body">
                                <p class="mb-1">Total Pago</p>
                                <h4 class="mb-0">R$ {{ totais_financeiros.total_pagamentos|default(0)|number_format(2, ',', '.') }}</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-sm-6">
                <div class="widget-stat card">
                    <div class="card-body p-4">
                        <div class="media ai-icon">
                            <span class="me-3 bgl-info text-info">
                                <i class="fa-light fa-chart-line"></i>
                            </span>
                            <div class="media-body">
                                <p class="mb-1">Saldo</p>
                                <h4 class="mb-0">R$ {{ totais_financeiros.saldo|default(0)|number_format(2, ',', '.') }}</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estatísticas por Status -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Contas a Receber por Status</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Status</th>
                                        <th class="text-end">Quantidade</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for stat in estatisticas_contas %}
                                    <tr>
                                        <td>{{ stat.status }}</td>
                                        <td class="text-end">{{ stat.total }}</td>
                                    </tr>
                                    {% else %}
                                    <tr>
                                        <td colspan="2" class="text-center">Nenhum dado disponível</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title">Faturas por Status</h4>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Status</th>
                                        <th class="text-end">Quantidade</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for stat in estatisticas_faturas %}
                                    <tr>
                                        <td>{{ stat.status }}</td>
                                        <td class="text-end">{{ stat.total }}</td>
                                    </tr>
                                    {% else %}
                                    <tr>
                                        <td colspan="2" class="text-center">Nenhum dado disponível</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    window.DOMAIN = '{{ DOMAIN }}';
    
    document.getElementById('btnLimparFiltros')?.addEventListener('click', function() {
        document.querySelector('input[name="data_inicio"]').value = '';
        document.querySelector('input[name="data_fim"]').value = '';
        document.getElementById('filtrosRelatorio').submit();
    });
</script>
{% endblock %}

